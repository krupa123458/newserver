name: Deploy to EC2

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      # Step 1: Checkout the repository
      - name: Checkout code
        uses: actions/checkout@v3

      # Step 2: SSH and run deployment script
      - name: Deploy to EC2
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.EC2_HOST }}          # EC2 public IP or DNS
          username: ubuntu                       # Change if using Amazon Linux: ec2-user
          key: ${{ secrets.EC2_SSH_KEY }}        # Your private key stored as GitHub secret
          script_stop: true                       # Stop workflow if any command fails
          script: |
            echo "Connecting to EC2 host..."
            cd /home/ubuntu/deploy
            bash deploy.sh
